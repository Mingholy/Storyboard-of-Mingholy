---
title: 'JavaScript 小笔记：关于闭包和this的用法'
date: 2017-02-14
cover: '3.jpg'
category: "JavaScript"
tags:
    - JavaScript
---

又到了一年一度的情人节。本来应该哄女朋友的，好在她理解我白天给老板搬砖的苦，连今天都没有太粘人。想想还是得对得起人家的一番好意，不能断更。  
这一篇主要是对闭包的理解和this用法的总（zhuan）结（zai）。这两个基本上是JS中必考的内容，对于我这样的初学者来说也算是老大难问题。所以还是总结一下。
## 关于闭包
其实Python中也存在类似的概念，因此标签上也挂了Python。
我的理解是闭包实际上是一类特殊的函数。其实它的概念和作用非常简单。  
* 首先闭包是__可以读取一个函数内部变量的函数__。
* 其次这种函数一定是在要读取内部变量的那个函数的内部。

所以它的作用是：
* 读取其他函数内部变量
* 使其他函数内部变量驻留在内存中
<!-- more -->
既然提到了函数内部外部这种概念，那么函数和变量的作用域就要再总结一下了。
* 函数内部可以读取全局变量
* 函数内部声明非全局变量，必须使用`var`，否则就是在声明全局变量
* 在函数外部调用函数内部变量：
  * 在函数A内部定义新函数B
  * 函数A中的所有局部变量，对B都是可见的
  * 函数B中所有局部变量，对A都是不可见的
  * 这种关系叫做__"链式作用域"__
  * 父对象的所有变量都对子对象可见，反之则不行

## 关于`this`的用法
`this`关键字在JavaScript中一般指代代码当前上下文。
1. 如果this没有被设置，则默认指向全局对象，通常是`window`。
2. 如果一个函数中运行了一个内联函数，比如一个事件监听器，则`this`指向内联函数的源代码。例如，当设置一个按钮的单击处理程序，`this`将应用匿名函数内的按钮。
3. 如果函数是一个对象的构造函数，则`this`指向新对象。
4. 如果函数被定义在一个对象上，然后调用该对象，则`this`指向该对象。
5. 在异步编程中，`this`可以很容易改变过程中的一个功能操作。保持处理程序上下文的小技巧：将其设置到闭包内的一个变量，当在上下文改变的地方调用一个函数时，如`setTimeout`，可以通过该变量引用需要的对象。

操作`this`的另一种方法是通过`call`、`apply`和`bind`。关于该三者的区别，会有专题来总结。三种方法都被用于调用一个函数，并能指定`this`的上下文供其他代码使用。
